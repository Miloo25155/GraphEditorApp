<!--
TODO:

* Dynamic month selection for developement purposes
* Year separation with stroked lines every 12 points
* Preset function (linear pos/neg, exp, ln, sqr)

-->



<!DOCTYPE html>
<html>
<head>
	<title>No Regression App - Dev in Progress</title>
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>
	<script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
 	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css" integrity="sha384-oS3vJWv+0UjzBfQzYUhtDYW+Pj2yciDJxpsK1OYPAYjqT085Qq/1cq5FLXAZQ7Ay" crossorigin="anonymous">
 	<link rel="stylesheet" href="index.css">
</head>

<body>
	<div id="appContainer">
		<div id="graphContainer">
			<div v-for="(point, index) in points" v-on:mousedown="selectPoint(index)"
			 	 v-bind:id="'point_' + index" v-bind:class="{ 'selected': currentSelectedPointIndex === index }" class="pointInContainer">
				<span v-bind:style="{ fontSize: pointSize + 'px' }" class="fa fa-circle"></span>
			</div>
			<svg style="width: 100%;height:100%;">
				<line v-for="(line, index) in lines" stroke="black"
				  	v-bind:x1="line.x1" v-bind:y1="line.y1" v-bind:x2="line.x2" v-bind:y2="line.y2"/>  <!--class="graph-line"-->
			</svg>
		</div>
		<p>x: {{this.mouseX}} ; y: {{this.mouseY}}</p>
		<p>{{currentSelectedPointIndex}}</p>
	</div>
</body>
</html>

<script>
	var mainVue = new Vue({
		el: "#appContainer",
		data: {
			container: null,

			points:[],
			currentSelectedPointIndex: -1,
			pointSize: 8,
			currentPointElement: null,

			lines: [],

			months:12,

			mouseX: 0,
			mouseY: 0,

			naturalTopMargin: 20
		},
		mounted: function(){
			this.generatePoints();
			Vue.nextTick(function(){
				this.calculatePointPosition();
				this.generateLines();
			}.bind(this))

			document.addEventListener("mouseup", function(){
				mainVue.deselectPoint();
			})
		},
		methods:{
			generatePoints: function(){
				this.container = document.getElementById("graphContainer");

				let reminderGap = this.container.offsetWidth % this.months;
				let pointsGap = (this.container.offsetWidth - reminderGap) / this.months;

				let freeSpace = pointsGap / this.months;

				for (let i = 0; i < this.months+1; i++) {
					let point = { x: i*pointsGap - this.pointSize/2, y: 50}
					this.points.push(point);
				}
			},
			generateLines: function(){
				for (let i = 0; i < this.points.length-1; i++) {
					let line = {
						x1: this.points[i].x + this.pointSize/2,
						y1: this.points[i].y - this.pointSize,
						x2: this.points[i+1].x + this.pointSize/2,
						y2: this.points[i+1].y - this.pointSize
					}
					this.lines.push(line);
				}
			},
			calculatePointPosition: function(){
				for (let i = 0; i < this.points.length; i++) {
					let point = document.getElementById("point_"+i);

					point.style.left = this.points[i].x + "px";
					point.style.top = this.points[i].y + "px";
				}
			},
			calculateSinglePointPosition: function(index){
				let point = document.getElementById("point_"+index);
				point.style.left = this.points[index].x + "px";
				point.style.top = this.points[index].y + "px";
			},
			selectPoint: function(index){
				this.currentSelectedPointIndex = index;

				this.currentPointElement = document.getElementById("point_"+index);

				document.addEventListener("mousemove", function(e){
					if(this.currentPointElement != null){			
						let mouseY = e.clientY - this.container.offsetTop;

						this.mouseX = e.clientX - this.container.offsetLeft;
						this.mouseY = mouseY;

						if(mouseY < (this.pointSize/2) + this.naturalTopMargin || mouseY > this.container.offsetHeight){
							return;
						}

						mouseY -= 10;

						this.points[this.currentSelectedPointIndex].y = mouseY;
						this.currentPointElement.style.top = mouseY + "px";

						mouseY -= this.pointSize;

						if(this.currentSelectedPointIndex === this.points.length-1)
						{
							this.lines[this.currentSelectedPointIndex-1].y2 = mouseY;
						} 
						else if(this.currentSelectedPointIndex === 0)
						{
							this.lines[this.currentSelectedPointIndex].y1 = mouseY;
						} 
						else
						{
							this.lines[this.currentSelectedPointIndex-1].y2 = mouseY;
							this.lines[this.currentSelectedPointIndex].y1 = mouseY;
						}
					}
				}.bind(this))

			},
			deselectPoint: function(){
				//delete listener
				this.currentPointElement = null;
				document.removeEventListener("mousemove", null);
				this.currentSelectedPointIndex = -1;
			},
		}
	});
</script>